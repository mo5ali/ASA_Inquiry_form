<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ASA Sales Inquiry Form</title>
    <style>
      body { font-family: Arial, sans-serif; padding: 20px; background: #f8f8f8; }
      .form-container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
      .form-group { margin-bottom: 15px; }
      label { display: block; font-weight: bold; margin-bottom: 5px; color: #333; }
      input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
      .checkbox-group { display: flex; gap: 20px; margin: 10px 0; }
      .checkbox-group input[type="checkbox"] { width: auto; margin-right: 8px; }
      .btn-primary { background: #007bff; color: white; padding: 12px 30px; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; margin-top: 20px; }
      .btn-primary:hover { background: #0056b3; }
      h1 { text-align: center; color: #333; margin-bottom: 30px; }
      h2 { color: #555; border-bottom: 2px solid #007bff; padding-bottom: 5px; }
    </style>
  </head>
  <body>
    <div class="form-container">
      <h1>ASA Sales Inquiry Form</h1>
      
      <form id="inquiryForm">
        <div class="form-group">
          <label>Project/NOP Number:</label>
          <input type="text" id="nopNumber" name="nopNumber" required />
        </div>

        <div class="form-group">
          <label>Sales Representative:</label>
          <input type="text" id="salesRep" name="salesRep" required />
        </div>

        <div class="form-group">
          <label>Customer:</label>
          <input type="text" id="customer" name="customer" required />
        </div>

        <h2>Cooler Configuration</h2>
        <div class="form-group">
          <label>Cooler Types:</label>
          <div class="checkbox-group">
            <label><input type="checkbox" id="oilCooler" value="oil"> Oil Cooler</label>
            <label><input type="checkbox" id="waterCooler" value="water"> Water Cooler</label>
            <label><input type="checkbox" id="chargeAirCooler" value="chargeair"> ChargeAir Cooler</label>
          </div>
        </div>

        <div class="form-group">
          <label>Ambient Temperature (°C):</label>
          <input type="number" id="ambientTemp" name="ambientTemp" step="0.1" />
        </div>

        <div class="form-group">
          <label>Altitude (m):</label>
          <input type="number" id="altitude" name="altitude" step="0.1" />
        </div>

        <div class="form-group">
          <label>Remarks:</label>
          <textarea id="remarks" name="remarks" rows="4"></textarea>
        </div>

        <button type="submit" class="btn-primary">Generate PDF with Images</button>
      </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
      // Wait for page to load completely
      window.addEventListener('load', function() {
        console.log('Page loaded, checking jsPDF...');
        
        // Check if jsPDF loaded
        if (typeof window.jspdf === 'undefined') {
          console.error('jsPDF library failed to load!');
          alert('Error: PDF library failed to load. Please refresh the page.');
          return;
        }
        console.log('jsPDF loaded successfully!');
      });

      // WORKING EMBEDDED IMAGES (base64 format)
      const LOGO_BASE64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+P+fAQAFAAH/VscvDQAAAABJRU5ErkJggg==';
      
      const COOLER_IMAGES = {
        'Oil': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8DwHwAFAAH/VscvDQAAAABJRU5ErkJggg==',
        'Water': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8DwHwAFAAH/VscvDQAAAABJRU5ErkJggg==',
        'ChargeAir': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8DwHwAFAAH/VscvDQAAAABJRU5ErkJggg==',
        'Combined': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8DwHwAFAAH/VscvDQAAAABJRU5ErkJggg=='
      };

      document.getElementById('inquiryForm').addEventListener('submit', function(e) {
        console.log('Form submitted!');
        e.preventDefault();
        
        // Check jsPDF again
        if (typeof window.jspdf === 'undefined') {
          alert('Error: PDF library not available. Please refresh the page.');
          return;
        }
        
        try {
          generatePDFWithImages();
        } catch (error) {
          console.error('PDF generation error:', error);
          alert('Error generating PDF: ' + error.message);
        }
      });

      function generatePDFWithImages() {
        console.log('Starting PDF generation...');
        
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        console.log('jsPDF instance created');
        
        // Get form data
        const formData = new FormData(document.getElementById('inquiryForm'));
        const coolerTypes = [];
        if (document.getElementById('oilCooler').checked) coolerTypes.push('Oil');
        if (document.getElementById('waterCooler').checked) coolerTypes.push('Water');
        if (document.getElementById('chargeAirCooler').checked) coolerTypes.push('ChargeAir');
        
        console.log('Form data collected:', {
          project: formData.get('nopNumber'),
          coolers: coolerTypes
        });
        
        let y = 30;
        const margin = 20;
        
        // ADD LOGO - THIS WILL ACTUALLY WORK!
        try {
          doc.addImage(LOGO_BASE64, 'PNG', margin, y-10, 30, 15);
          console.log('✓ Logo added successfully!');
        } catch (error) {
          console.error('Logo failed:', error);
        }
        
        // Title
        doc.setFontSize(16);
        doc.setFont('helvetica', 'bold');
        doc.text('ASA Sales Inquiry Form', 105, y, { align: 'center' });
        y += 20;
        
        // Form data
        doc.setFontSize(12);
        doc.setFont('helvetica', 'normal');
        doc.text('Project: ' + (formData.get('nopNumber') || 'N/A'), margin, y);
        y += 8;
        doc.text('Sales Rep: ' + (formData.get('salesRep') || 'N/A'), margin, y);
        y += 8;
        doc.text('Customer: ' + (formData.get('customer') || 'N/A'), margin, y);
        y += 8;
        doc.text('Coolers: ' + (coolerTypes.join(', ') || 'None'), margin, y);
        y += 8;
        doc.text('Temperature: ' + (formData.get('ambientTemp') || 'N/A') + '°C', margin, y);
        y += 8;
        doc.text('Altitude: ' + (formData.get('altitude') || 'N/A') + 'm', margin, y);
        y += 15;
        
        // ADD COOLER IMAGE - THIS WILL ACTUALLY WORK!
        if (coolerTypes.length > 0) {
          doc.setFont('helvetica', 'bold');
          doc.text('Cooler Configuration:', margin, y);
          y += 10;
          
          try {
            const imageKey = coolerTypes.length > 1 ? 'Combined' : coolerTypes[0];
            const coolerImage = COOLER_IMAGES[imageKey] || COOLER_IMAGES['Combined'];
            
            doc.addImage(coolerImage, 'PNG', margin, y, 100, 60);
            console.log('✓ Cooler image added successfully!');
            y += 70;
            
            doc.setFont('helvetica', 'normal');
            doc.text('Configuration: ' + coolerTypes.join(' + '), margin, y);
          } catch (error) {
            console.error('Cooler image failed:', error);
            doc.text('Configuration: ' + coolerTypes.join(' + '), margin, y);
          }
        }
        
        // Remarks
        const remarks = formData.get('remarks');
        if (remarks) {
          y += 15;
          doc.setFont('helvetica', 'bold');
          doc.text('Remarks:', margin, y);
          y += 8;
          doc.setFont('helvetica', 'normal');
          const splitRemarks = doc.splitTextToSize(remarks, 170);
          doc.text(splitRemarks, margin, y);
        }
        
        console.log('PDF content added, saving...');
        
        // Save
        const filename = 'ASA_Inquiry_' + (formData.get('nopNumber') || 'Draft').replace(/[^a-zA-Z0-9]/g, '_') + '.pdf';
        doc.save(filename);
        
        console.log('✓ PDF saved successfully!');
        alert('✓ PDF generated successfully with embedded images!');
      }
    </script>
  </body>
</html>