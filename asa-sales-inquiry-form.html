<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ASA Sales Inquiry Form</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html, body {
        height: 100vh;
        overflow: hidden;
        font-family: Arial, sans-serif;
        background: #f8f8f8;
      }

      .main-layout {
        display: flex;
        height: 100vh;
        width: 100vw;
      }

      /* Left panel - 40% width */
      .form-panel {
        width: 40%;
        background: white;
        padding: 20px;
        border-right: 2px solid #ddd;
        overflow-y: auto;
        overflow-x: hidden;
      }

      /* Right panel - 60% width */
      .preview-panel {
        width: 60%;
        position: relative;
        background: #f0f0f0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #ddd;
      }

      .header img {
        height: 50px;
        width: auto;
      }

      .header h2 {
        margin: 0;
        color: #333;
      }

      /* Form groups - labels next to inputs */
      .form-group {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
        gap: 12px;
      }

      .form-group label {
        min-width: 140px;
        font-weight: 500;
        color: #555;
        font-size: 14px;
      }

      .form-group input[type="text"],
      .form-group input[type="number"] {
        flex: 1;
        padding: 8px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background: white;
      }

      /* Textarea group - keep label on top for textarea */
      .textarea-group {
        margin-bottom: 15px;
      }

      .textarea-group label {
        display: block;
        font-weight: 500;
        color: #555;
        font-size: 14px;
        margin-bottom: 5px;
      }

      .textarea-group textarea {
        width: 100%;
        padding: 8px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background: white;
        min-height: 80px;
        resize: vertical;
      }

      /* Checkbox group - horizontal layout */
      .checkbox-group {
        margin-bottom: 20px;
      }

      .checkbox-group > label {
        font-weight: 500;
        color: #555;
        font-size: 14px;
        margin-bottom: 8px;
        display: block;
      }

      .checkbox-container {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
      }

      .checkbox-item input[type="checkbox"] {
        margin-right: 6px;
        width: 18px;
        height: 18px;
        cursor: pointer;
      }

      .checkbox-item label {
        margin: 0;
        cursor: pointer;
        font-weight: normal;
        color: #555;
        font-size: 14px;
      }

      /* Inline input with dropdown */
      .inline-input-group {
        display: flex;
        gap: 10px;
        align-items: center;
        flex: 1;
      }

      .inline-input-group input {
        flex: 1;
      }

      .inline-input-group select {
        width: 100px;
        padding: 8px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background: white;
      }

      /* Conditional sections */
      .conditional-section {
        display: none;
        margin-top: 15px;
        margin-bottom: 15px;
        padding: 15px;
        background: #f9f9f9;
        border-left: 3px solid #4CAF50;
        border-radius: 4px;
      }

      .conditional-section.active {
        display: block;
      }

      .conditional-section h3 {
        font-size: 16px;
        color: #333;
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 1px solid #ddd;
      }

      /* Dropdown selections */
      select {
        width: 100%;
        padding: 8px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background: white;
      }

      /* Performance group */
      .performance-group {
        margin-top: 10px;
      }

      .performance-row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        align-items: center;
      }

      .performance-row label {
        min-width: 140px;
        font-weight: 500;
        color: #555;
        font-size: 14px;
      }

      .performance-row select {
        flex: 1;
      }

      /* Image upload */
      .file-upload {
        margin-bottom: 15px;
      }

      .file-upload label {
        display: block;
        font-weight: 500;
        color: #555;
        font-size: 14px;
        margin-bottom: 5px;
      }

      .file-upload input[type="file"] {
        width: 100%;
        padding: 8px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background: white;
      }

      /* Submit button */
      .submit-btn {
        width: 100%;
        padding: 12px;
        font-size: 16px;
        font-weight: 600;
        color: white;
        background: #4CAF50;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 20px;
      }

      .submit-btn:hover {
        background: #45a049;
      }

      /* Preview panel content */
      .preview-content {
        text-align: center;
        color: #888;
      }

      .preview-content h3 {
        font-size: 24px;
        margin-bottom: 10px;
      }

      .preview-images {
        margin-top: 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
      }

      .preview-images img {
        max-width: 200px;
        max-height: 200px;
        border: 2px solid #ddd;
        border-radius: 4px;
      }

      /* Scrollbar styling for webkit browsers */
      .form-panel::-webkit-scrollbar {
        width: 8px;
      }

      .form-panel::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
      }

      .form-panel::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 4px;
      }

      .form-panel::-webkit-scrollbar-thumb:hover {
        background: #a1a1a1;
      }
    </style>
  </head>
  <body>
    <div class="main-layout">
      <!-- Left Panel - Form -->
      <div class="form-panel">
        <div class="header">
          <img src="Z:\Allgemein\Temp\MA\ASA-2017-clear-q5wbyrbl7shpdhw75ixpkziyjbxg04yk9z9dpdln6s.png" alt="ASA Logo">
          <h2>Sales Inquiry Form</h2>
        </div>

        <form id="inquiryForm">
          <!-- Project/NOP Number -->
          <div class="form-group">
            <label for="nopNumber">Project/NOP Number:</label>
            <input type="text" id="nopNumber" name="nopNumber" required />
          </div>

          <!-- Sales Representative -->
          <div class="form-group">
            <label for="salesRep">Sales Representative:</label>
            <input type="text" id="salesRep" name="salesRep" required />
          </div>

          <!-- Customer -->
          <div class="form-group">
            <label for="customer">Customer:</label>
            <input type="text" id="customer" name="customer" required />
          </div>

          <!-- Cooler Type Checkboxes - Horizontal -->
          <div class="checkbox-group">
            <label>Cooler Type:</label>
            <div class="checkbox-container">
              <div class="checkbox-item">
                <input type="checkbox" id="oilCooler" name="coolerType" value="oil" />
                <label for="oilCooler">Oil cooler</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="waterCooler" name="coolerType" value="water" />
                <label for="waterCooler">Water cooler</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="chargeAirCooler" name="coolerType" value="chargeair" />
                <label for="chargeAirCooler">ChargeAir cooler</label>
              </div>
            </div>
          </div>

          <!-- Ambient Air Temperature with units -->
          <div class="form-group">
            <label for="ambientTemp">Ambient Air Temp.:</label>
            <div class="inline-input-group">
              <input type="number" id="ambientTemp" name="ambientTemp" step="0.1" />
              <select id="ambientTempUnit" name="ambientTempUnit">
                <option value="C">°C</option>
                <option value="F">°F</option>
              </select>
            </div>
          </div>

          <!-- Altitude with units -->
          <div class="form-group">
            <label for="altitude">Altitude:</label>
            <div class="inline-input-group">
              <input type="number" id="altitude" name="altitude" step="0.1" />
              <select id="altitudeUnit" name="altitudeUnit">
                <option value="m">m</option>
                <option value="ft">ft</option>
              </select>
            </div>
          </div>

          <!-- Fan and Count -->
          <div class="form-group">
            <label for="fan">Fan:</label>
            <input type="text" id="fan" name="fan" style="flex: 2; margin-right: 15px;" />
            <label for="fanCount" style="min-width: 60px;">Count:</label>
            <input type="number" id="fanCount" name="fanCount" value="1" style="width: 60px;" />
          </div>

          <!-- Fan Noise Level -->
          <div class="form-group">
            <label for="maxSoundLevel">Fan Noise:</label>
            <input type="number" id="maxSoundLevel" name="maxSoundLevel" style="flex: 1; margin-right: 10px;" step="0.1" />
            <select id="soundUnit" name="soundUnit" style="min-width: 80px;">
              <option value="dB(A)">dB(A)</option>
              <option value="dB">dB</option>
              <option value="sone">sone</option>
            </select>
          </div>

          <!-- Oil Cooler Section (Conditional) -->
          <div id="oilSection" class="conditional-section">
            <h3>Oil Cooler Configuration</h3>
            
            <div class="form-group">
              <label for="oilType">Oil type:</label>
              <input type="text" id="oilType" name="oilType" />
            </div>

            <div class="form-group">
              <label for="oilEntryTemp">Oil Entry Temp.:</label>
              <div class="inline-input-group">
                <input type="number" id="oilEntryTemp" name="oilEntryTemp" step="0.1" />
                <select id="oilEntryTempUnit" name="oilEntryTempUnit">
                  <option value="C">°C</option>
                  <option value="F">°F</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="oilFlowrate">Flowrate:</label>
              <div class="inline-input-group">
                <input type="number" id="oilFlowrate" name="oilFlowrate" step="0.1" />
                <select id="oilFlowrateUnit" name="oilFlowrateUnit">
                  <option value="L/min">L/min</option>
                  <option value="GPM">GPM</option>
                  <option value="m3/s">m³/s</option>
                  <option value="kg/s">kg/s</option>
                  <option value="lb/s">lb/s</option>
                </select>
              </div>
            </div>

            <div class="performance-group">
              <div class="performance-row">
                <label for="oilDesiredPerf">Desired Performance:</label>
                <select id="oilDesiredPerf" name="oilDesiredPerf">
                  <option value="">Select...</option>
                  <option value="capacity">Capacity</option>
                  <option value="specific">Specific perf.</option>
                  <option value="exit">Exit temp.</option>
                </select>
                <input type="number" id="oilPerfValue" name="oilPerfValue" step="0.1" style="margin-left: 10px; flex: 1; padding: 8px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px; background: white;" />
                <select id="oilPerfUnit" name="oilPerfUnit" style="margin-left: 10px; width: 120px;">
                  <option value="">Select performance first...</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Water Cooler Section (Conditional) -->
          <div id="waterSection" class="conditional-section">
            <h3>Water Cooler Configuration</h3>
            
            <div class="form-group">
              <label for="medium">Medium:</label>
              <input type="text" id="medium" name="medium" value="50/50 WaterGlycol" />
            </div>

            <div class="form-group">
              <label for="waterEntryTemp">Medium Entry Temp.:</label>
              <div class="inline-input-group">
                <input type="number" id="waterEntryTemp" name="waterEntryTemp" step="0.1" />
                <select id="waterEntryTempUnit" name="waterEntryTempUnit">
                  <option value="C">°C</option>
                  <option value="F">°F</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="waterFlowrate">Flowrate:</label>
              <div class="inline-input-group">
                <input type="number" id="waterFlowrate" name="waterFlowrate" step="0.1" />
                <select id="waterFlowrateUnit" name="waterFlowrateUnit">
                  <option value="L/min">L/min</option>
                  <option value="GPM">GPM</option>
                  <option value="m3/s">m³/s</option>
                  <option value="kg/s">kg/s</option>
                  <option value="lb/s">lb/s</option>
                </select>
              </div>
            </div>

            <div class="performance-group">
              <div class="performance-row">
                <label for="waterDesiredPerf">Desired Performance:</label>
                <select id="waterDesiredPerf" name="waterDesiredPerf">
                  <option value="">Select...</option>
                  <option value="capacity">Capacity</option>
                  <option value="specific">Specific perf.</option>
                  <option value="exit">Exit temp.</option>
                </select>
                <input type="number" id="waterPerfValue" name="waterPerfValue" step="0.1" style="margin-left: 10px; flex: 1; padding: 8px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px; background: white;" />
                <select id="waterPerfUnit" name="waterPerfUnit" style="margin-left: 10px; width: 120px;">
                  <option value="">Select performance first...</option>
                </select>
              </div>
            </div>
          </div>

          <!-- ChargeAir Cooler Section (Conditional) -->
          <div id="chargeAirSection" class="conditional-section">
            <h3>ChargeAir Cooler Configuration</h3>
            
            <div class="form-group">
              <label for="chargeAirType">ChargeAir type:</label>
              <input type="text" id="chargeAirType" name="chargeAirType" />
            </div>

            <div class="form-group">
              <label for="chargeAirEntryTemp">ChargeAir Entry Temp.:</label>
              <div class="inline-input-group">
                <input type="number" id="chargeAirEntryTemp" name="chargeAirEntryTemp" step="0.1" />
                <select id="chargeAirEntryTempUnit" name="chargeAirEntryTempUnit">
                  <option value="C">°C</option>
                  <option value="F">°F</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="chargeAirFlowrate">Flowrate:</label>
              <div class="inline-input-group">
                <input type="number" id="chargeAirFlowrate" name="chargeAirFlowrate" step="0.1" />
                <select id="chargeAirFlowrateUnit" name="chargeAirFlowrateUnit">
                  <option value="L/min">L/min</option>
                  <option value="GPM">GPM</option>
                  <option value="m3/s">m³/s</option>
                  <option value="kg/s">kg/s</option>
                  <option value="lb/s">lb/s</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="chargeAirPressure">Pressure:</label>
              <div class="inline-input-group">
                <input type="number" id="chargeAirPressure" name="chargeAirPressure" step="0.1" />
                <select id="chargeAirPressureUnit" name="chargeAirPressureUnit">
                  <option value="bar">bar</option>
                  <option value="Pa">Pa</option>
                  <option value="kPa">kPa</option>
                  <option value="MPa">MPa</option>
                  <option value="mmHg">mmHg</option>
                  <option value="PSI">PSI</option>
                </select>
              </div>
            </div>

            <div class="performance-group">
              <div class="performance-row">
                <label for="chargeAirDesiredPerf">Desired Performance:</label>
                <select id="chargeAirDesiredPerf" name="chargeAirDesiredPerf">
                  <option value="">Select...</option>
                  <option value="capacity">Capacity</option>
                  <option value="specific">Specific perf.</option>
                  <option value="exit">Exit temp.</option>
                </select>
                <input type="number" id="chargeAirPerfValue" name="chargeAirPerfValue" step="0.1" style="margin-left: 10px; flex: 1; padding: 8px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px; background: white;" />
                <select id="chargeAirPerfUnit" name="chargeAirPerfUnit" style="margin-left: 10px; width: 120px;">
                  <option value="">Select performance first...</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Image Upload -->
          <div class="file-upload">
            <label for="images">Upload Images:</label>
            <input type="file" id="images" name="images" accept="image/*" multiple />
          </div>

          <!-- Remarks -->
          <div class="textarea-group">
            <label for="remarks">Remarks/Extra Requirements:</label>
            <textarea id="remarks" name="remarks" rows="4"></textarea>
          </div>

          <!-- Generate Button -->
          <button type="submit" class="submit-btn">Generate PDF</button>
        </form>
      </div>

      <!-- Right Panel - Preview -->
      <div class="preview-panel">
        <div class="preview-content">
          <h3>Cooler Configuration</h3>
          
          <!-- Instructions label in top right -->
          <div id="instructionLabel" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.95); padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 12px; color: #555; max-width: 250px; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 1000; display: none;">
            Please enter the minimum design envelope constraints (width, height, depth)<br>
            Please specify units
          </div>
          
          <div id="coolerImageContainer" style="margin: 5px 0; text-align: center; position: relative; display: inline-block;">
            <img id="coolerImage" src="" alt="Select cooler types to see configuration" style="width: 120%; height: auto; display: none; border: 2px solid #ddd; border-radius: 8px;" />
            
            <!-- Overlay text boxes for dimensions -->
            <div id="dimensionOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none;">
              <!-- Common dimension boxes -->
              <input type="text" id="coolerWidthBox" class="dimension-input" placeholder="Width" style="position: absolute; width: 80px; height: 25px; font-size: 12px; text-align: center; border: 1px solid #333; background: rgba(255,255,255,0.9); pointer-events: auto;" />
              <input type="text" id="coreHeightBox" class="dimension-input" placeholder="Core H" style="position: absolute; width: 80px; height: 25px; font-size: 12px; text-align: center; border: 1px solid #333; background: rgba(255,255,255,0.9); pointer-events: auto;" />
              <input type="text" id="coolerHeightBox" class="dimension-input" placeholder="Height" style="position: absolute; width: 80px; height: 25px; font-size: 12px; text-align: center; border: 1px solid #333; background: rgba(255,255,255,0.9); pointer-events: auto;" />
              <input type="text" id="depthBox" class="dimension-input" placeholder="Depth" style="position: absolute; width: 80px; height: 25px; font-size: 12px; text-align: center; border: 1px solid #333; background: rgba(255,255,255,0.9); pointer-events: auto;" />
              
              <!-- Core width boxes (variable number) -->
              <input type="text" id="coreWidth1Box" class="dimension-input core-width" placeholder="Core W1" style="position: absolute; width: 80px; height: 25px; font-size: 12px; text-align: center; border: 1px solid #333; background: rgba(255,255,255,0.9); pointer-events: auto; display: none;" />
              <input type="text" id="coreWidth2Box" class="dimension-input core-width" placeholder="Core W2" style="position: absolute; width: 80px; height: 25px; font-size: 12px; text-align: center; border: 1px solid #333; background: rgba(255,255,255,0.9); pointer-events: auto; display: none;" />
              <input type="text" id="coreWidth3Box" class="dimension-input core-width" placeholder="Core W3" style="position: absolute; width: 80px; height: 25px; font-size: 12px; text-align: center; border: 1px solid #333; background: rgba(255,255,255,0.9); pointer-events: auto; display: none;" />
            </div>
            
            <p id="coolerImagePlaceholder" style="color: #888; font-style: italic;">Select cooler types to see configuration diagram</p>
          </div>
          <div class="preview-images" id="imagePreview"></div>
        </div>
      </div>
    </div>

    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
      // Wait for docx to load
      function waitForDocx(callback) {
        if (window.docx) {
          callback();
        } else {
          setTimeout(() => waitForDocx(callback), 100);
        }
      }
      // Handle Oil Cooler checkbox
      document.getElementById('oilCooler').addEventListener('change', function() {
        const oilSection = document.getElementById('oilSection');
        if (this.checked) {
          oilSection.classList.add('active');
        } else {
          oilSection.classList.remove('active');
        }
        updateCoolerImage();
      });

      // Handle Water Cooler checkbox
      document.getElementById('waterCooler').addEventListener('change', function() {
        const waterSection = document.getElementById('waterSection');
        if (this.checked) {
          waterSection.classList.add('active');
        } else {
          waterSection.classList.remove('active');
        }
        updateCoolerImage();
      });

      // Handle ChargeAir Cooler checkbox
      document.getElementById('chargeAirCooler').addEventListener('change', function() {
        const chargeAirSection = document.getElementById('chargeAirSection');
        if (this.checked) {
          chargeAirSection.classList.add('active');
        } else {
          chargeAirSection.classList.remove('active');
        }
        updateCoolerImage();
      });

      // Function to update cooler configuration image
      function updateCoolerImage() {
        const oilChecked = document.getElementById('oilCooler').checked;
        const waterChecked = document.getElementById('waterCooler').checked;
        const chargeAirChecked = document.getElementById('chargeAirCooler').checked;
        
        const coolerImage = document.getElementById('coolerImage');
        const placeholder = document.getElementById('coolerImagePlaceholder');
        const overlay = document.getElementById('dimensionOverlay');
        const instructionLabel = document.getElementById('instructionLabel');
        
        let imagePath = '';
        let coreCount = 0;
        
        // Check if any cooler is selected
        const anyCoolerSelected = oilChecked || waterChecked || chargeAirChecked;
        
        // Show/hide instruction label based on selection
        if (anyCoolerSelected) {
          instructionLabel.style.display = 'block';
        } else {
          instructionLabel.style.display = 'none';
        }
        
        // Determine which image to show based on selected combinations
        if (waterChecked && oilChecked && chargeAirChecked) {
          imagePath = 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\RAD_OC_CAC.png';
          coreCount = 3;
        } else if (waterChecked && oilChecked) {
          imagePath = 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\RAD_OC.png';
          coreCount = 2;
        } else if (waterChecked && chargeAirChecked) {
          imagePath = 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\RAD_CAC.png';
          coreCount = 2;
        } else if (oilChecked && chargeAirChecked) {
          imagePath = 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\OC_CAC.png';
          coreCount = 2;
        } else if (waterChecked) {
          imagePath = 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\RAD.png';
          coreCount = 1;
        } else if (oilChecked) {
          imagePath = 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\OC.png';
          coreCount = 1;
        } else if (chargeAirChecked) {
          imagePath = 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\CAC.png';
          coreCount = 1;
        }
        
        if (imagePath) {
          coolerImage.src = imagePath;
          coolerImage.style.display = 'block';
          placeholder.style.display = 'none';
          overlay.style.display = 'block';
          
          // Position dimension boxes based on configuration
          positionDimensionBoxes(coreCount, waterChecked, oilChecked, chargeAirChecked);
        } else {
          coolerImage.style.display = 'none';
          placeholder.style.display = 'block';
          overlay.style.display = 'none';
        }
      }
      
      // Function to position dimension boxes
      function positionDimensionBoxes(coreCount, water, oil, chargeAir) {
        // Hide all core width boxes first
        document.querySelectorAll('.core-width').forEach(box => box.style.display = 'none');
        
        // Common positions (approximate % from top-left of image)
        document.getElementById('coolerWidthBox').style.left = '20%';
        document.getElementById('coolerWidthBox').style.top = '82%';
        
        document.getElementById('coolerHeightBox').style.left = '100%';
        document.getElementById('coolerHeightBox').style.top = '60%';
        
        document.getElementById('coreHeightBox').style.left = '75%';
        document.getElementById('coreHeightBox').style.top = '60%';
        
        document.getElementById('depthBox').style.left = '80%';
        document.getElementById('depthBox').style.top = '20%';
        
        // Show and position core width boxes based on configuration
        if (coreCount >= 1) {
          const core1 = document.getElementById('coreWidth1Box');
          core1.style.display = 'block';
          
          if (coreCount === 1) {
            core1.style.left = '40%';
            core1.style.top = '10%';
          } else if (coreCount === 2) {
            core1.style.left = '20%';
            core1.style.top = '10%';
            
            const core2 = document.getElementById('coreWidth2Box');
            core2.style.display = 'block';
            core2.style.left = '50%';
            core2.style.top = '15%';
          } else if (coreCount === 3) {
            core1.style.left = '15%';
            core1.style.top = '10%';
            
            const core2 = document.getElementById('coreWidth2Box');
            core2.style.display = 'block';
            core2.style.left = '35%';
            core2.style.top = '20%';
            
            const core3 = document.getElementById('coreWidth3Box');
            core3.style.display = 'block';
            core3.style.left = '55%';
            core3.style.top = '30%';
          }
        }
      }

      // Handle Oil Desired Performance dropdown
      document.getElementById('oilDesiredPerf').addEventListener('change', function() {
        const perfUnit = document.getElementById('oilPerfUnit');
        perfUnit.innerHTML = '';
        
        if (this.value === 'capacity') {
          perfUnit.innerHTML = `
            <option value="kW">kW</option>
            <option value="BTU/min">BTU/min</option>
            <option value="HP">HP</option>
          `;
        } else if (this.value === 'specific') {
          perfUnit.innerHTML = `
            <option value="kW/°C">kW/°C</option>
            <option value="BTU/min.F">BTU/min.F</option>
          `;
        } else if (this.value === 'exit') {
          perfUnit.innerHTML = `
            <option value="°C">°C</option>
            <option value="°F">°F</option>
          `;
        } else {
          perfUnit.innerHTML = '<option value="">Select performance first...</option>';
        }
      });

      // Handle Water Desired Performance dropdown
      document.getElementById('waterDesiredPerf').addEventListener('change', function() {
        const perfUnit = document.getElementById('waterPerfUnit');
        perfUnit.innerHTML = '';
        
        if (this.value === 'capacity') {
          perfUnit.innerHTML = `
            <option value="kW">kW</option>
            <option value="BTU/min">BTU/min</option>
            <option value="HP">HP</option>
          `;
        } else if (this.value === 'specific') {
          perfUnit.innerHTML = `
            <option value="kW/°C">kW/°C</option>
            <option value="BTU/min.F">BTU/min.F</option>
          `;
        } else if (this.value === 'exit') {
          perfUnit.innerHTML = `
            <option value="°C">°C</option>
            <option value="°F">°F</option>
          `;
        } else {
          perfUnit.innerHTML = '<option value="">Select performance first...</option>';
        }
      });

      // Handle ChargeAir Desired Performance dropdown
      document.getElementById('chargeAirDesiredPerf').addEventListener('change', function() {
        const perfUnit = document.getElementById('chargeAirPerfUnit');
        perfUnit.innerHTML = '';
        
        if (this.value === 'capacity') {
          perfUnit.innerHTML = `
            <option value="kW">kW</option>
            <option value="BTU/min">BTU/min</option>
            <option value="HP">HP</option>
          `;
        } else if (this.value === 'specific') {
          perfUnit.innerHTML = `
            <option value="kW/°C">kW/°C</option>
            <option value="BTU/min.F">BTU/min.F</option>
          `;
        } else if (this.value === 'exit') {
          perfUnit.innerHTML = `
            <option value="°C">°C</option>
            <option value="°F">°F</option>
          `;
        } else {
          perfUnit.innerHTML = '<option value="">Select performance first...</option>';
        }
      });

      // Store uploaded images for PDF
      let uploadedImages = [];
      
      // Simple image paths (no preloading to avoid fetch issues)
      const imageUrls = {
        'logo': 'Z:\\Allgemein\\Temp\\MA\\ASA-2017-clear-q5wbyrbl7shpdhw75ixpkziyjbxg04yk9z9dpdln6s.png',
        'CAC': 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\CAC.png',
        'OC': 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\OC.png',
        'OC_CAC': 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\OC_CAC.png',
        'RAD': 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\RAD.png',
        'RAD_CAC': 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\RAD_CAC.png',
        'RAD_OC': 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\RAD_OC.png',
        'RAD_OC_CAC': 'Z:\\Allgemein\\Temp\\MA\\ASA_Inquiry_form\\RAD_OC_CAC.png'
      };
      
      // Handle image preview
      document.getElementById('images').addEventListener('change', function(e) {
        const previewContainer = document.getElementById('imagePreview');
        previewContainer.innerHTML = '';
        uploadedImages = []; // Reset uploaded images array
        
        const files = e.target.files;
        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
              const img = document.createElement('img');
              img.src = e.target.result;
              previewContainer.appendChild(img);
              
              // Store image data for PDF
              uploadedImages.push({
                name: file.name,
                data: e.target.result
              });
            };
            reader.readAsDataURL(file);
          }
        }
      });

      // Check if jsPDF is available
      function waitForJsPDF(callback) {
        if (typeof window.jspdf !== 'undefined') {
          console.log('jsPDF is ready!');
          callback();
        } else {
          console.log('Waiting for jsPDF to load...');
          setTimeout(() => waitForJsPDF(callback), 100);
        }
      }

      // Handle form submission - Generate PDF
      document.getElementById('inquiryForm').addEventListener('submit', function(e) {
        e.preventDefault();
        console.log('Form submission started...');
        
        // Wait for jsPDF to be available
        waitForJsPDF(() => {
          try {
            generatePDF();
          } catch (error) {
            console.error('PDF Generation Error:', error);
            alert('Error generating PDF: ' + error.message);
          }
        });
      });
      
      function generateWordDocument() {
        // Access docx properly
        const Document = docx.Document;
        const Packer = docx.Packer;
        const Paragraph = docx.Paragraph;
        const TextRun = docx.TextRun;
        const ImageRun = docx.ImageRun;
        const HeadingLevel = docx.HeadingLevel;
        
        // Collect form data
        const formData = new FormData(document.getElementById('inquiryForm'));
        
        // Get selected cooler types
        const coolerTypes = [];
        if (document.getElementById('oilCooler').checked) coolerTypes.push('Oil Cooler');
        if (document.getElementById('waterCooler').checked) coolerTypes.push('Water Cooler');
        if (document.getElementById('chargeAirCooler').checked) coolerTypes.push('ChargeAir Cooler');
        
        const children = [];
        
        // Title with ASA text (no logo for now to avoid fetch issues)
        children.push(
          new Paragraph({
            children: [new TextRun("ASA - Sales Inquiry Form")],
            heading: HeadingLevel.TITLE,
            alignment: "center"
          })
        );
        
        // Project Information
        children.push(
          new Paragraph({
            text: "Project Information",
            heading: HeadingLevel.HEADING_1
          })
        );
        
        const projectInfo = [
          'Project/NOP: ' + (formData.get('nopNumber') || 'Not specified'),
          'Sales Rep: ' + (formData.get('salesRep') || 'Not specified'),
          'Customer: ' + (formData.get('customer') || 'Not specified'),
          'Cooler Types: ' + (coolerTypes.length ? coolerTypes.join(', ') : 'None selected'),
          'Ambient Temp: ' + (formData.get('ambientTemp') || 'Not specified') + ' ' + (formData.get('ambientTempUnit') || ''),
          'Altitude: ' + (formData.get('altitude') || 'Not specified') + ' ' + (formData.get('altitudeUnit') || ''),
          'Fan: ' + (formData.get('fan') || 'Not specified'),
          'Fan Count: ' + (formData.get('fanCount') || 'Not specified')
        ];
        
        projectInfo.forEach(line => {
          children.push(
            new Paragraph({
              children: [new TextRun(line)]
            })
          );
        });
        
        // Design Constraints
        children.push(
          new Paragraph({
            text: "Design Envelope Constraints",
            heading: HeadingLevel.HEADING_1
          })
        );
        
        const dimensions = [
          'Cooler Width: ' + (document.getElementById('coolerWidthBox').value || 'Not specified'),
          'Cooler Height: ' + (document.getElementById('coolerHeightBox').value || 'Not specified'),
          'Core Height: ' + (document.getElementById('coreHeightBox').value || 'Not specified'),
          'Depth: ' + (document.getElementById('depthBox').value || 'Not specified')
        ];
        
        // Add core widths if they have values
        const core1 = document.getElementById('coreWidth1Box').value;
        const core2 = document.getElementById('coreWidth2Box').value;
        const core3 = document.getElementById('coreWidth3Box').value;
        
        if (core1) dimensions.push('Core Width 1: ' + core1);
        if (core2) dimensions.push('Core Width 2: ' + core2);
        if (core3) dimensions.push('Core Width 3: ' + core3);
        
        dimensions.forEach(line => {
          children.push(
            new Paragraph({
              children: [new TextRun(line)]
            })
          );
        });
        
        // Add cooler configuration info (text only for now)
        const configType = getConfigurationName(coolerTypes).replace(' configuration', '');
        
        if (coolerTypes.length > 0) {
          children.push(
            new Paragraph({
              children: [new TextRun("Cooler Configuration")],
              heading: HeadingLevel.HEADING_1
            })
          );
          
          children.push(
            new Paragraph({
              children: [new TextRun('Configuration: ' + getConfigurationName(coolerTypes))]
            })
          );
          
          children.push(
            new Paragraph({
              children: [new TextRun('Configuration diagram: ' + configType + ' (see attached files)')]
            })
          );
        }
        
        // Add cooler configurations
        if (document.getElementById('oilCooler').checked) {
          addCoolerConfigToWord(children, 'Oil Cooler Configuration', {
            'Oil Type': formData.get('oilType'),
            'Entry Temp': (formData.get('oilEntryTemp') || '') + ' ' + (formData.get('oilEntryTempUnit') || ''),
            'Flowrate': (formData.get('oilFlowrate') || '') + ' ' + (formData.get('oilFlowrateUnit') || ''),
            'Performance': formData.get('oilDesiredPerf'),
            'Performance Value': (formData.get('oilPerfValue') || '') + ' ' + (formData.get('oilPerfUnit') || '')
          }, Paragraph, TextRun, HeadingLevel);
        }
        
        if (document.getElementById('waterCooler').checked) {
          addCoolerConfigToWord(children, 'Water Cooler Configuration', {
            'Medium': formData.get('medium'),
            'Entry Temp': (formData.get('waterEntryTemp') || '') + ' ' + (formData.get('waterEntryTempUnit') || ''),
            'Flowrate': (formData.get('waterFlowrate') || '') + ' ' + (formData.get('waterFlowrateUnit') || ''),
            'Performance': formData.get('waterDesiredPerf'),
            'Performance Value': (formData.get('waterPerfValue') || '') + ' ' + (formData.get('waterPerfUnit') || '')
          }, Paragraph, TextRun, HeadingLevel);
        }
        
        if (document.getElementById('chargeAirCooler').checked) {
          addCoolerConfigToWord(children, 'ChargeAir Cooler Configuration', {
            'ChargeAir Type': formData.get('chargeAirType'),
            'Entry Temp': (formData.get('chargeAirEntryTemp') || '') + ' ' + (formData.get('chargeAirEntryTempUnit') || ''),
            'Flowrate': (formData.get('chargeAirFlowrate') || '') + ' ' + (formData.get('chargeAirFlowrateUnit') || ''),
            'Pressure': (formData.get('chargeAirPressure') || '') + ' ' + (formData.get('chargeAirPressureUnit') || ''),
            'Performance': formData.get('chargeAirDesiredPerf'),
            'Performance Value': (formData.get('chargeAirPerfValue') || '') + ' ' + (formData.get('chargeAirPerfUnit') || '')
          }, Paragraph, TextRun, HeadingLevel);
        }
        
        // Remarks
        const remarks = formData.get('remarks');
        if (remarks && remarks.trim()) {
          children.push(
            new Paragraph({
              text: "Remarks",
              heading: HeadingLevel.HEADING_1
            })
          );
          
          children.push(
            new Paragraph({
              children: [new TextRun(remarks)]
            })
          );
        }
        
        // Add uploaded images
        if (uploadedImages.length > 0) {
          children.push(
            new Paragraph({
              children: [new TextRun("Uploaded Images")],
              heading: HeadingLevel.HEADING_1
            })
          );
          
          uploadedImages.forEach((imageData, index) => {
            try {
              const imageBlob = base64ToBlob(imageData.data);
              children.push(
                new Paragraph({
                  children: [new TextRun(`Image ${index + 1}: ${imageData.name}`)]
                })
              );
              
              children.push(
                new Paragraph({
                  children: [
                    new ImageRun({
                      data: imageBlob,
                      transformation: {
                        width: 400,
                        height: 300,
                      },
                    }),
                  ],
                })
              );
            } catch (error) {
              console.error('Error adding uploaded image to Word doc:', error);
              children.push(
                new Paragraph({
                  children: [new TextRun(`Error: Could not add image ${imageData.name}`)]
                })
              );
            }
          });
        }
        
        // Create document
        const doc = new Document({
          sections: [{
            properties: {},
            children: children
          }]
        });
        
        // Save document
        Packer.toBlob(doc).then(blob => {
          const projectNumber = formData.get('nopNumber') || 'Unknown';
          const filename = `ASA_Inquiry_${projectNumber.replace(/[^a-zA-Z0-9]/g, '_')}.docx`;
          
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = filename;
          a.click();
          
          window.URL.revokeObjectURL(url);
          alert('Word document generated successfully!');
        }).catch(error => {
          console.error('Error saving Word document:', error);
          alert('Error saving Word document: ' + error.message);
        });
      }
      
      // Helper function to convert base64 to blob
      function base64ToBlob(base64, mimeType = 'image/png') {
        const byteCharacters = atob(base64.split(',')[1]);
        const byteNumbers = new Array(byteCharacters.length);
        for (let i = 0; i < byteCharacters.length; i++) {
          byteNumbers[i] = byteCharacters.charCodeAt(i);
        }
        const byteArray = new Uint8Array(byteNumbers);
        return new Blob([byteArray], { type: mimeType });
      }
      
      // Helper function to add cooler config to Word document
      function addCoolerConfigToWord(children, title, config, Paragraph, TextRun, HeadingLevel) {
        children.push(
          new Paragraph({
            children: [new TextRun(title)],
            heading: HeadingLevel.HEADING_2
          })
        );
        
        Object.entries(config).forEach(([key, value]) => {
          if (value && value.trim() && value !== ' ') {
            children.push(
              new Paragraph({
                children: [new TextRun(`${key}: ${value}`)]
              })
            );
          }
        });
      }
      
      function getConfigurationName(coolerTypes) {
        if (coolerTypes.length === 3) return 'RAD_OC_CAC configuration';
        if (coolerTypes.includes('Water Cooler') && coolerTypes.includes('Oil Cooler')) return 'RAD_OC configuration';
        if (coolerTypes.includes('Water Cooler') && coolerTypes.includes('ChargeAir Cooler')) return 'RAD_CAC configuration';
        if (coolerTypes.includes('Oil Cooler') && coolerTypes.includes('ChargeAir Cooler')) return 'OC_CAC configuration';
        if (coolerTypes.includes('Water Cooler')) return 'RAD configuration';
        if (coolerTypes.includes('Oil Cooler')) return 'OC configuration';
        if (coolerTypes.includes('ChargeAir Cooler')) return 'CAC configuration';
        return 'No configuration selected';
      }
    </script>
  </body>
</html>